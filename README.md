# Лабораторная работа 03. Инструменты разработки и тестирования, СКВ

## Задача

Разработать прототип простого эмулятора файл-сервера. Проект реализуется в 2 этапа.

### Этап 1 – Сервер и клиент на сокетах. Обработка текстовых файлов.

Клиентская программа в интерфейсе CLI запрашивает у пользователя действие, подключается к серверу, получает ответ, печатает его в читаемом формате и завершает работу.

Клиентская программа должна:

1. **Предложить пользователю ввести действие.**
2. **Запросить у пользователя имя файла, который будет создан, отправлен или удален.**
3. **Предложить пользователю ввести содержимое файла (если применимо).**
4. **Отправить запрос на сервер и получить ответ от сервера.**
5. **Распечатать соответствующее сообщение после получения ответа.**
6. **Отключиться от сервера и завершить работу.**

На этом этапе клиентская программа должна выполнять только один рабочий цикл.

Для управления файлами использовать аналог упрощенных HTTP-запросов.

### Пример запросов и ответов

- Запрос клиента должен начинаться с GET, PUT или DELETE. Ответ сервера, как и в HTTP, должен начинаться с кода состояния операции. Например, код 200 означает, что операция прошла успешно, и 404 означает, что ресурс не найден.

- Для создания нового файла на сервере клиент отправляет запрос PUT NAME DATA, где NAME указывается имя файла без пробелов и табуляции, а DATA указываются текстовые данные. Если файл с таким именем уже существует, сервер должен ответить кодом 403. Если файл на сервере создан успешно, сервер отвечает кодом 200. В этом случае клиент у себя должен распечатать `The response says that the file was created!`. В противном случае он должен напечатать `The response says that creating the file was forbidden!`.

- Чтобы получить файл с сервера, клиент должен отправить запрос GET NAME, где NAME имя файла. Если файла с таким именем не существует, сервер должен ответить кодом 404. Если файл с таким именем существует, сервер отвечает кодом 200, одним пробелом и содержимым файла. В этом случае клиент должен напечатать `The content of the file is: FILE_CONTENT`, где FILE_CONTENT— содержимое запрошенного файла. В противном случае он должен напечатать `The response says that the file was not found!`.

- Чтобы удалить файл с сервера, клиент должен отправить запрос DELETE NAME, где NAME имя файла. Если файла с таким именем не существует, сервер должен ответить кодом 404. Если файл успешно удален, сервер отвечает кодом 200. В этом случае клиент должен распечатать `The response says that the file was successfully deleted!`. В противном случае он должен напечатать `The response says that the file was not found!`.

### Серверная программа

Серверная программа, обрабатывает запросы один за другим в одном цикле. На этом этапе предполагается что запросы обрабатываются быстро и нет необходимости в параллельном выполнении.

Сервер должен размещать файлы клиента в папке .../server/data/.

Для завершения работы сервера реализовать его остановку по команде клиента exit.

Серверная программа должна:

1. **Распечатать Server started! при запуске программы.**
2. **Получите запрос от клиента и ответьте соответствующим образом.**
   - Для PUT запроса отправить код состояния 200, если файл создан успешно; в противном случае отправить код состояния 403.
   - Для GET запроса отправить код состояния 200 и FILE_CONTENT разделить его одним пробелом, если файл существует; в противном случае отправить код состояния 404.
   - Для DELETE запроса отправьте код состояния 200, если файл успешно удален; в противном случае отправить код состояния 404.
3. **Серверная программа не должна завершать работу до тех пор, пока не получит команду exit.**

## Этап 2 – Многопоточный сервер. Обработка произвольных файлов.

Клиент отправляет на сервер настоящие текстовые файлы и файлы изображений. Сервер хранит файлы и отправляет их обратно по запросу.

### Клиентская программа

Написать клиентскую программу, предлагающую пользователям действия.

1. Для действия GET и DELETE спросить пользователя, хочет ли он GET или DELETE файл BY_ID или BY_NAME (не требуется для PUT).
2. Предложить пользователю ввести содержимое файла (если применимо).
3. Отправьте запрос на сервер и получите ответ от сервера.
4. После получения ответа распечатать соответствующее сообщение и спросить пользователя, где он хотел бы сохранить полученный файл (если применимо).
5. Отключиться от сервера и завершить работу.

Если пользователь хочет сохранить файл на сервере, программа должна спросить пользователя, какой файл из папки ../client/data необходимо сохранить. После этого пользователю следует указать имя файла (имя не должно содержать пробелов и табуляций). Если пользователь не хочет указывать имя, ему следует просто нажать Enter ничего не вводя. Сервер должен сгенерировать уникальное имя для этого файла и отправить обратно идентификатор.

### Серверная программа

Сервер должен иметь возможность распознавать каждый файл по его уникальному идентификатору. Если файл создан успешно, сервер должен вывести после кода целочисленный идентификатор 200 и один пробел. Если создание файла не удалось, идентификатор не требуется.

#### Пример запросов и ответов

- Для PUT запроса отправьте код состояния 200 и уникальный код INTEGER IDENTIFIER, разделенные одним пробелом, если файл создан успешно; в противном случае отправить код состояния 403.
- Для GET запроса отправить код состояния 200 и FILE_CONTENT разделить его одним пробелом, если файл существует; в противном случае отправьте 404код состояния.
- Для DELETE запроса отправить код состояния 200, если файл успешно удален; в противном случае отправить код состояния 404.

#### Процесс сохранения файлов

Процесс сохранения файлов большего размера может занять некоторое время, поэтому следует использовать параллельный подход. Назначенные файлам идентификаторы сервер должен сохранять, они должны быть доступны и после перезагрузки сервера. Учитывайте также, что сопоставление идентификатора с именем файла должно использоваться синхронно, если к нему имеют доступ разные потоки.

#### Серверная программа

1. Распечатать Server started! сообщение при запуске программы.
2. Получите запрос от клиента и ответьте соответствующим образом.
3. Отправить ответ в зависимости от типа запроса:
   - Для PUT запроса отправьте код состояния 200 и уникальный код INTEGER IDENTIFIER, разделенные одним пробелом, если файл создан успешно; в противном случае отправить код состояния 403.
   - Для GET запроса отправить код состояния 200 и FILE_CONTENT разделить его одним пробелом, если файл существует; в противном случае отправьте 404код состояния.
   - Для DELETE запроса отправить код состояния 200, если файл успешно удален; в противном случае отправить код состояния 404.
4. Серверная программа не должна завершать работу до тех пор, пока не получит exit команду.
